**ุงููุชุทูุจ:** ุฅูุดุงุก ูุฎุทุท (Schema) ูุงูู ูุชูุซูู ุจูุงูุงุช ูุจุงุฑุงุฉ ุดุทุฑูุฌ (PGN) ูุงุจูุฉ ููุชุฎุฒูู ูุงูุงุณุชุนูุงู ูู ูุงุนุฏุฉ ุจูุงูุงุช Isar ุฏุงุฎู ุชุทุจูู Flutter. ูุฌุจ ุฃู ูุบุทู ุงููุฎุทุท ุฌููุน ุงูุจูุงูุงุช ุงููุตููุฉ (Tag Pairs) ูุชุณูุณู ุงูุญุฑูุงุช ูุงูุจูุงูุงุช ุงูุชุญููููุฉ.

### ุงููุฎุทุท ุงูููุชุฑุญ (Isar Schema - `ChessGame.dart`)

```dart
// @collection
class ChessGame {
  // 1. ุงูููุชุงุญ ุงูุฃุณุงุณู
  Id id = Isar.autoIncrement;

  // 2. ุชุฑููุณุฉ ุงูุญุฏุซ ุงูุฃุณุงุณูุฉ (Seven Tag Roster - STR)
  
  // @index(type: IndexType.value)
  String? event;            // [Event "World Championship"]
  String? site;             // [Site "New York, USA"]
  DateTime? date;           // [Date "2024.10.05"] (ูุชู ุชุญููููุง ูู String ุฅูู DateTime)
  String? round;            // [Round "1"]
  String? whitePlayer;      // [White "Kasparov, Garry"]
  String? blackPlayer;      // [Black "Karpov, Anatoly"]
  
  // @index()
  String? result;           // [Result "1-0"] - ููู ููููุชุฑุฉ (ููุฒุ ุชุนุงุฏู)

  // 3. ุงูุจูุงูุงุช ุงููุตููุฉ ูุงูุชุญููููุฉ ุงูุฅุถุงููุฉ (ููุชุฎุฒูู ุงูุณูู)
  String? eco;              // [ECO "D02"] - ููุฏ ุงูุงูุชุชุงุญูุฉ
  int? whiteElo;           // [WhiteElo "2750"]
  int? blackElo;           // [BlackElo "2680"]
  String? timeControl;      // [TimeControl "5+0"]
  
  // 4. ุชูุซูู ุญุงูุฉ ุงููุนุจุฉ (FEN + Raw PGN)
  String? startingFen;      // [FEN ...] - ูุชุณุฌูู ูุถุน ุงูุจุฏุงูุฉ ุบูุฑ ุงูููุงุณู
  String? fullPgn;          // ุงูุณูุณูุฉ ุงููุตูุฉ ุงููุงููุฉ ูููุจุงุฑุงุฉ (ููุนุฑุถ ูุงูุชุญููู ุงูุชูุตููู)

  // 5. ุงูุชูุซูู ุงูููููู ููุญุฑูุงุช (ููุชููู ูุงูุชุญููู ุงูุณุฑูุน)
  List<MoveData>? moves;  // ูุงุฆูุฉ ุจูุงุฆูุงุช ุตุบูุฑุฉ ูุชุฎุฒูู ูู ุญุฑูุฉ ูุจูุงูุงุชูุง

  // 6. ุจูุงูุงุช ุงููุดุบู (ุงุฎุชูุงุฑู: ูุชุชุจุน ุงููุณุชุฎุฏู ุงููุญูู)
  String? userId;           // ูุชุชุจุน ุงููุณุชุฎุฏู ุงูุฐู ูุนุจ/ุญูู ุงููุจุงุฑุงุฉ.
}

// @embedded
class MoveData {
  String? san;          // ุงูุญุฑูุฉ ุจุตูุบุฉ SAN (ูุซุงู: Nf3, Nxe5#)
  String? lan;          // ุงูุญุฑูุฉ ุจุตูุบุฉ LAN (ูุซุงู: g1f3, f3e5)
  String? comment;      // ุงูุชุนูููุงุช ุงููุฑููุฉ ุจุงูุญุฑูุฉ {ูุซู ูุฐุง ุงูุชุนููู}
  String? nag;          // ุฑูุฒ ุงูุชูููู ุงูุฑููู ููุญุฑูุฉ (ูุซุงู: $2)
  String? fenAfter;     // ูุถุน FEN ุจุนุฏ ูุฐู ุงูุญุฑูุฉ (ููู ููุงุณุชุฑุฌุงุน ุงูุณุฑูุน ูููุถุน)
  List<String>? variations; // ุงููุชุบูุฑุงุช ุงููุตูุฉ (ุงูููุณูู) ููุฐุง ุงูุฏูุฑ (ูุซุงู: [ "1... c5 {ุงูุฏูุงุน ุงูุตููู}" ] )
}
```

-----

## ๐ ูุซุงู ูุงูู ููููู ููุจูุงูุงุช ุงููุฎุฒูุฉ (ูุจู ุฅุฏุฎุงููุง ูู Isar)

**ุงูุณููุงุฑูู:** ูุจุงุฑุงุฉ ูุตูุฑุฉ ุจููุฒ ุงูุฃุจูุถ ูุน ุชุนูููุงุช ูุชุญููู ุจุณูุท: `1. e4 e5 2. Nf3 Nc6 3. Bc4 Nf6 {ูุฎ ุจุณูุท} 4. Ng5 d5 5. exd5 Nxd5 6. d4 h6 7. Nf3 e4 8. Ne5 Nxe5 9. dxe5 Bc5 10. O-O O-O $6 {ุฎุทุฃ ูุงุฏุญ} 11. Qxd5 Bb6 12. Qxe4 c6 13. Nc3 Be6 14. Bd3 f5 15. exf6 Qxf6 16. Qh7+ Kf7 17. Ne4 Qd8 18. Bxh6 Re8 19. Qxg7# 1-0`

| ุงูุญูู (ูู `ChessGame`) | ููุน ุงูุจูุงูุงุช | ุงููููุฉ ุงููุฎุฒูุฉ | ููุงุญุธุงุช |
| :--- | :--- | :--- | :--- |
| `id` | `Id` | `1` | ูููุดุฃ ุชููุงุฆููุง ุจูุงุณุทุฉ Isar. |
| `event` | `String` | `"Example Game with Annotations"` | |
| `whitePlayer` | `String` | `"Player A"` | |
| `blackPlayer` | `String` | `"Player B"` | |
| `result` | `String` | `"1-0"` | **ููููุฑุณ** ููุจุญุซ ุนู ุฌููุน ุงูุชุตุงุฑุงุช ุงููุงุนุจ A. |
| `whiteElo` | `int` | `2400` | |
| `blackElo` | `int` | `2350` | |
| `fullPgn` | `String` | ุณูุณูุฉ PGN ุงููุงููุฉ ุฃุนูุงู | ูุชุฎุฒูู ุงููุตุฏุฑ ุงูุฃุตูู ูููุจุงุฑุงุฉ. |
| `moves` | `List<MoveData>` | (ุงูุธุฑ ุงูุฌุฏูู ุงูุชุงูู) | ุงูุจูุงูุงุช ุงููููููุฉ. |

### ูุซุงู ูู `moves` (ูุณุชุฎูุต ูู ุจูุงูุงุช ุงูุญุฑูุฉ 3 ู 10)

| ุงูุญูู (ูู `MoveData`) | ุงูุญุฑูุฉ 3 (3. Bc4) | ุงูุญุฑูุฉ 10 (10... O-O $6) | ููุงุญุธุงุช |
| :--- | :--- | :--- | :--- |
| `san` | `"Bc4"` | `"O-O"` | ุชูุซูู ูุฎุชุตุฑ ููุญุฑูุฉ. |
| `lan` | `"f1c4"` | `"e8g8"` | ุชูุซูู ุทููู ููุญุฑูุฉ. |
| `nag` | `null` | `"$6"`| ุฑูุฒ ุงูุฎุทุฃ ุงููุงุฏุญ. | |`comment`|`null`|`null`| | |`fenAfter`|`"r1bqkb1r/pppp1ppp/2n2n2/4p3/2B1P3/5N2/PPPP1PPP/RNBQK2R b KQkq - 3 3"`|`"r1bq1rk1/ppp2ppp/2p5/2b1P3/2BPP3/5N2/PPP2PPP/RNBQ1RK1 w - - 0 11"\` | ูุถุน ุงูููุญุฉ ุจุนุฏ ูุฐู ุงูุญุฑูุฉ. |

-----

## ๐พ ุทุฑููุฉ ุงูุชุฎุฒูู ูุงูุงุณุชุฑุฌุงุน (ุงูููุทู ูู Flutter)

### 1\. ูุฑุญูุฉ ุงูุชุฎุฒูู (ุนูุฏ ูุฑุงุกุฉ ููู PGN)

1.  **ูุฑุงุกุฉ PGN ูุชุญูููู:** ูุชู ุงุณุชุฎุฏุงู ููุชุจุฉ Flutter ูุชุญููู PGN (ูุซู `flutter_chess_pgn` ุฃู ุจูุงุก ูุญูู ุจุณูุท).
2.  **ููุก ุงููุฎุทุท (`ChessGame`):**
      * ูุชู ุงุณุชุฎุฑุงุฌ ุงูู **Tag Pairs** ูููุก ุงูุญููู ุงูุฃุณุงุณูุฉ (`event`, `whitePlayer`, `elo`, ุฅูุฎ).
      * ูุชู ุชุญููู **ุชุณูุณู ุงูุญุฑูุงุช** ุญุฑูุฉ ุจุญุฑูุฉ. ููู ุญุฑูุฉุ ูุชู ุฅูุดุงุก ูุงุฆู **`MoveData`** ูุถู ุงูู SANุ ูุงูุชุนูููุงุชุ ูุงูู NAGsุ ูุงูุฃูู: ุญุณุงุจ ูุถุน **FEN** ุจุนุฏ ุงูุญุฑูุฉ.
      * ูุชู ุชุฎุฒูู ุฌููุน ูุงุฆูุงุช `MoveData` ูู ุงููุงุฆูุฉ **`moves`** ุงูุฎุงุตุฉ ุจูุงุฆู `ChessGame`.
3.  **ุงููุชุงุจุฉ ุฅูู Isar:** ูุชู ุญูุธ ูุงุฆู `ChessGame` ุงููุงูู ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
    ```dart
    final isar = Isar.getInstance();
    await isar.chessGames.put(game); // ุชุฎุฒูู ูุงุฆู ุงููุนุจุฉ
    ```

### 2\. ูุฑุญูุฉ ุงูุงุณุชุฑุฌุงุน (ููุงุฌูุฉ ุงููุณุชุฎุฏู)

**ุฃูุซูุฉ ุงูุงุณุชุนูุงูุงุช ุจุงุณุชุฎุฏุงู Isar Query:**

| ุงููุฏู ูู ุงูุงุณุชุนูุงู | ูุซุงู Isar Query |
| :--- | :--- |
| **ุนุฑุถ ุฌููุน ุงููุจุงุฑูุงุช ุงูุชู ูุงุฒ ุจูุง "Player A"** | `isar.chessGames.filter().whitePlayerEqualTo("Player A").and().resultEqualTo("1-0").findAll()` |
| **ุงูุจุญุซ ุงูุณุฑูุน ุนู ูุจุงุฑุงุฉ ุจุชุงุฑูุฎ ูุนูู** | `isar.chessGames.filter().dateEqualTo(targetDate).findAll()` |
| **ุงุณุชุฑุฌุงุน ูุถุน ูุนูู (FEN) ุจุนุฏ ุงูุญุฑูุฉ ุงูู 20** | `isar.chessGames.filter().idEqualTo(gameId).findFirst().then((game) { return game?.moves?[19].fenAfter; });` |
| **ุงุณุชุฑุฌุงุน ุงูุชุญููู (NAGs) ูููุจุงุฑุงุฉ** | `isar.chessGames.filter().idEqualTo(gameId).findFirst().then((game) { // ููููู ุงูุชูุฑุงุฑ ุนูู game.moves ููุจุญุซ ุนู NAGs });` |

ุจูุฐู ุงูุทุฑููุฉุ ูุชู ุชุฎุฒูู ุงูุจูุงูุงุช ุจุดูู **ููููู ููุงุจู ููุงุณุชุนูุงู** (ูุซู ุงูุฃุณูุงุก ูุงููุชุงุฆุฌ ูElo) ูุน ุงูุงุญุชูุงุธ ุจุงููุฏุฑุฉ ุนูู ุฅุนุงุฏุฉ ุจูุงุก ุงููุนุจุฉ ุจุงููุงูู ุนุจุฑ ูุงุฆูุฉ `moves` ุฃู ุงููุต ุงูุฎุงู `fullPgn`.